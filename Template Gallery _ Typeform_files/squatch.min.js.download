!function(){"use strict";var e,o=!1,t={},r=!1,n=!1,a=null,i=null,s=!0;window.console&&console.log||(console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}});var c=function(){0==arguments[0].readyState?console.error("Failed to load script"):console.error("Failed to parse script: "+arguments[2].toString())},d=function(e){var o;switch(o=e instanceof Array?e[0]:e){case"init":R(e[1]);break;case"autofill":b(e[1]);break;case"getRewardBalance":k(e[1],e[2]);break;case"getRewardFeatureBalance":T(e[1],e[2]);break;case"getReward":q(e[1]);break;case"open":_();break;case"close":h();break;case"subscribe":C(e[1],e[2]);break;default:console.error("Unknown method call `"+o+"`. Valid options are [init,autofill,getReward,getRewardBalance]")}},u=function(e){e(document).ready(function(e){i=e;for(var o=0;o<window._sqh.length;o++){var t=window._sqh[o];"subscribe"==t[0]&&(d(t),window._sqh.splice(o,1))}for(var r=-1,o=0;o<window._sqh.length;o++){var t=window._sqh[o];if("init"==t[0]){d(t),r=o;break}}r>-1?window._sqh.splice(r,1):console.error('Could not find "init" in the _sqh queue when squatch.js was loaded.')})},l=function(e){if(void 0===e||!e){for(var o=window._sqh.shift();o;)d(o),o=window._sqh.shift();window._sqh.push=function(){for(var e=0;e<arguments.length;e++)d(arguments[e]);return Array.prototype.push.apply(this,arguments)}}},p=function(e,o){window._sqh.push([e,o])},m=function(e){return(void 0===e.host?location.protocol+"//app.referralsaasquatch.com":location.protocol+"//"+e.host)+"/a/"+e.tenant_alias+"/"},f=function(e){var o=m(e)+"widgets/squatchcookie";new window.easyXDM.Rpc({remote:o},{local:{init:function(e){a={code:e},l(!1)}}})},_=function(){i("#squatchModalWrapper").length>0?i("#squatchModalWrapper").trigger("squatch:open"):console.error("The squatch widget must be loaded in popup mode to be opened")},h=function(){i("#squatchModalWrapper").length>0?i("#squatchModalWrapper").trigger("squatch:close"):console.error("The squatch widget must be loaded in popup mode to be closed")},w=function(e){for(var t=e.auto_open_param?e.auto_open_param:"squatch_open",r=window.location.search.substring(1),n=r.split("&"),a=0;a<n.length;a++)if(n[a]===t)var s=setInterval(function(){i(document).ready(function(){_(),o=!0}),o&&clearInterval(s)},1e3)},g=function(e,o){var t,r;"_IGNORE_"==e.payment_provider_id?(t=e.account_id,r="_IGNORE_"):"UNREGISTERED"==e.payment_provider_id?(t="_IGNORE_",r=e.account_id):(t=e.payment_provider_id,r=null===e.account_id?"":e.account_id);var n;return n="_IGNORE_"!=r?"systemId="+encodeURIComponent(r)+("_IGNORE_"!=t?"&paymentProviderId="+encodeURIComponent(t):""):"_IGNORE_"!=t?"paymentProviderId="+encodeURIComponent(t):"",m(e)+"widgets/squatchwidget?"+n+"&userId="+encodeURIComponent(e.user_id)+("_IGNORE_"!=e.email?"&email="+encodeURIComponent(e.email):"")+"&firstName="+encodeURIComponent(e.first_name)+"&lastName="+encodeURIComponent(e.last_name)+("_IGNORE_"!=e.user_image?"&userImage="+encodeURIComponent(e.user_image):"")+("_IGNORE_"!=e.checksum?"&paramChecksum="+encodeURIComponent(e.checksum):"")+("_IGNORE_"!=e.jwt?"&paramJwt="+encodeURIComponent(e.jwt):"")+("_IGNORE_"!=e.locale?"&locale="+encodeURIComponent(e.locale):"")+("_IGNORE_"!=e.fb_share_image?"&fbShareImage="+encodeURIComponent(e.fb_share_image):"")+("_IGNORE_"!=e.account_status?"&accountStatus="+encodeURIComponent(e.account_status):"")+("_IGNORE_"!=e.referral_code?"&referralCode="+encodeURIComponent(e.referral_code):"")+("_IGNORE_"!=e.user_referral_code?"&userReferralCode="+encodeURIComponent(e.user_referral_code):"")+"&pageType="+o+"&mode="+e.mode},v=function(e,o,r,n,c){var d=g(e,c);return new window.easyXDM.Rpc({remote:d,container:o,props:{allowtransparency:"true",scrolling:"no",marginwidth:"0",marginheight:"0",frameborder:"no"}},{local:{init:function(t,n,i,c,d){s=d,o.getElementsByTagName("iframe")[0].style.height=t+"px",o.getElementsByTagName("iframe")[0].style.width="EMBED"!=e.mode&&"DEMO_EMBED"!=e.mode||s?n+"px":"100%",a={code:i,rewardBalance:c},r(!1)},resize:function(t,r){o.getElementsByTagName("iframe")[0].style.height=t+"px",o.getElementsByTagName("iframe")[0].style.width="EMBED"!=e.mode&&"DEMO_EMBED"!=e.mode||s?r+"px":"100%",i(window).trigger("resize.modal")},publish:function(e,o){if(t[e])for(var r=0;r<t[e].length;r++)t[e][r](o)},close:function(){n()},error:function(t,n,a){console.error(t),s=!1,o.getElementsByTagName("iframe")[0].style.height="EMBED"==e.mode||"DEMO_EMBED"==e.mode?"100%":n+"px",o.getElementsByTagName("iframe")[0].style.width="EMBED"==e.mode||"DEMO_EMBED"==e.mode?"100%":a+"px",r(!0)}},remote:{openedWidget:{},closedWidget:{}}})},y=function(e){var o=g(e,""),t=document.createElement("div");i("<div></div>").hide().append(t).appendTo("body");new window.easyXDM.Rpc({remote:o,container:t,props:{allowtransparency:"true",scrolling:"no",marginwidth:"0",marginheight:"0",frameborder:"no"}},{local:{init:function(e,o){a={code:e,reward:o},l(!1)},error:function(e){console.error(e)}}})},E=function(e){if(i("#squatchembed").length>0){var o=document.createElement("div");i("<div></div>").hide().attr("id","squatchEmbedWrapper").append(o).insertAfter(i("#squatchembed"));v(e,o,function(e){setTimeout(function(){i("#squatchembed").hide(),i("#squatchEmbedWrapper").show(),l(e)},500)},function(){},"embeddedWidget").openedWidget(e.mode,e.user_id,e.account_id)}else e.mode="NOCONTENT",y(e)},I=function(o){i("<link>",{rel:"stylesheet",type:"text/css",href:e+"/assets/css/widget/external/reveal.min.css"}).appendTo("head"),i.getScript(e+"/assets/javascripts/reveal.min.js",function(){var e=document.createElement("div");e.setAttribute("id","squatchModal"),e.setAttribute("class","reveal-modal"),i("<div></div>").attr("id","squatchModalWrapper").append(e).appendTo("body");var t=function(){i("#squatchModalWrapper").trigger("squatch:close")},r=v(o,e,l,t,"modalPopup");i("#squatchModalWrapper").on("reveal:close","#squatchModal",function(){r.closedWidget()}),i("body").on("click",".squatchpop",function(e){e.preventDefault(),i("#squatchModalWrapper").trigger("squatch:open")}),i("#squatchModalWrapper").on("squatch:close",function(e){i("#squatchModal").trigger("reveal:close")}),i("#squatchModalWrapper").on("squatch:open",function(e){r.openedWidget(o.mode,o.user_id,o.account_id),i("#squatchModal").reveal()}),w(o)}).fail(c)},R=function(o){if(!r){r=!0,o.tenant_alias||console.error("tenant_alias must be set"),void 0!==o.autofill&&p("autofill",o.autofill);var t;if(void 0===o.account_id)t=f;else{if(n=!0,!o.user_id||!o.first_name)return void console.error("The user_id, email, first_name must be set");switch(o.last_name||(o.last_name=""),void 0===o.email&&(o.email="_IGNORE_"),void 0===o.payment_provider_id?o.payment_provider_id="_IGNORE_":null===o.payment_provider_id&&(o.payment_provider_id="UNREGISTERED"),void 0===o.checksum&&(o.checksum="_IGNORE_"),void 0===o.jwt&&(o.jwt="_IGNORE_"),"_IGNORE_"==o.checksum&&"_IGNORE_"==o.jwt&&o.user_image&&o.user_image.len>0&&console.error("User images will not be accepted without signed requests."),o.checksum||o.jwt||(o.checksum||(o.checksum=""),o.jwt||(o.jwt=""),console.error("Checksum or JWT not set properly for signed widget request.")),void 0===o.user_image?o.user_image="_IGNORE_":o.user_image||(o.user_image=""),void 0===o.fb_share_image?o.fb_share_image="_IGNORE_":o.fb_share_image||(o.fb_share_image=""),void 0===o.account_status?o.account_status="_IGNORE_":o.account_status||(o.account_status=""),void 0===o.referral_code?o.referral_code="_IGNORE_":o.referral_code||(o.referral_code=""),void 0===o.user_referral_code?o.user_referral_code="_IGNORE_":o.user_referral_code||(o.user_referral_code=""),void 0===o.locale?o.locale="_IGNORE_":o.locale||(o.locale=""),o.mode=o.mode||0===o.mode?o.mode:"POPUP",o.mode){case"NOCONTENT":t=y;break;case"EMBED":t=E;break;case"POPUP":case"DEMO":t=I;break;case"DEMO_EMBED":t=E;break;default:console.error("Unsupported mode: '"+o.mode+"'. Please initialize with one of the following modes: 'NOCONTENT', 'EMBED', or 'POPUP'")}}t&&(i.ajaxSetup({cache:!0}),i.getScript(e+"/assets/javascripts/easyXDM.min.js",function(){t(o)}).fail(c))}},b=function(e){"string"==typeof e?a.code&&i(e).val(a.code):"function"==typeof e?e(a.code):console.error('The "autofill" method should be called with either a jQuery selector or a callback. Unknown type '+typeof e)},q=function(e){"function"==typeof e?n?e(N()):console.error("Unsupported reward lookup widget push, you need to push with an account Id to use this feature"):console.error("Unsupported widget reward lookup push, invalid params.")},N=function(){var e={};if(a.rewardBalance)for(var o=0;o<a.rewardBalance.length;o++)"PCT_DISCOUNT"==a.rewardBalance[o].type&&(e=a.rewardBalance[o]);else console.warn("Reward balance could not be found, it may not be implemented in your widget theme.");return void 0!==e.type?{type:"PCT_DISCOUNT",details:{discountPercentage:e.totalDiscountPercent,referrerDiscountPercent:e.referrerDiscountPercent,referredDiscountPercent:e.referredDiscountPercent}}:{type:"PCT_DISCOUNT",details:{discountPercentage:0,referrerDiscountPercent:0,referredDiscountPercent:0}}},O=function(e){var o=[];if(a.rewardBalance)for(var t=0;t<a.rewardBalance.length;t++)a.rewardBalance[t].type==e&&o.push(a.rewardBalance[t]);else console.warn("Reward balance could not be found, it may not be implemented in your widget theme.");return o},k=function(e,o){n?"string"==typeof e?"function"==typeof o?o(O(e)):console.error("Unsupported widget reward type lookup push, invalid params."):"function"==typeof e?e(a.rewardBalance):console.error("Unsupported widget reward lookup push, invalid params."):console.error("Unsupported reward lookup widget push, you need to push with an account Id to use this feature")},T=function(e,o){if(n)if("string"==typeof e&&"function"==typeof o){for(var t=O("FEATURE"),r=[],a=0;a<t.lenght;a++)t[a].featureType==e&&r.push(t[a]);o(r)}else console.error("Unsupported widget reward type lookup push, invalid params.");else console.error("Unsupported reward lookup widget push, you need to push with an account Id to use this feature")},C=function(e,o){t[e]||(t[e]=[]),t[e].push(o)},M=function(o){if(!o)return void console.error("Could not find properly formatted squatch.js DOM scripts");e=o.match(new RegExp("https?://[^/]*"))[0];var t=function(){window.squatchQuery=window.jQuery.noConflict(!0),u(window.squatchQuery)},r=new RegExp("[1].[7-9](.[0-9])?");if(void 0!==window.jQuery&&r.test(window.jQuery.fn.jquery))u(window.jQuery);else{var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",e+"/assets/javascripts/jquery-1.9.0.min.js"),n.readyState?n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||t()}:n.onload=t,(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(n)}},U=function(e){for(var o,t,r=document.getElementsByTagName("script"),n=r.length,a=/squatch(\.min)?\.js(\?.*)*$/;n--;)if((o=r[n].src)&&o.match(a)){t=o;break}t||e<=0?M(t):setTimeout(function(){U(--e)},50)};"undefined"==typeof _sqh?console.error("_sqh must be defined and initialized to use this widget.\nTo initialize the popup widget call: _sqh.push(['init', {tenant_alias: '$yourTenantAlias', account_id: '$viewingCustomerAccountId', email: '$viewingCustomerEmail', user_id : '$viewingUserId', first_name: '$viewingCustomerFirstName', last_name: '$viewingCustomerLastName']}]);"):U(10)}();